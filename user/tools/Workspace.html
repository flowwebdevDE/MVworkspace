<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ef-Shops.at ShopMaster 1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .hidden-tab { display: none; }
    .active-tab { display: block; }
    .modal-bg {
      background: rgba(0,0,0,0.5);
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    .modal {
      background: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      max-width: 400px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .dark body {
      background-color: #1a202c;
      color: #f9fafb;
    }
    .dark header,
    .dark .bg-white {
      background-color: #2d3748 !important;
      color: #f9fafb !important;
    }
    .dark .text-gray-800 {
      color: #f9fafb !important;
    }
    .dark input,
    .dark select,
    .dark textarea {
      background-color: #4a5568;
      color: #ffffff;
      border-color: #718096;
    }
    .dark .border {
      border-color: #718096;
    }
    .dark .hover\\:bg-gray-100:hover {
      background-color: #4a5568 !important;
    }
    .dark table,
    .dark th,
    .dark td {
      background-color: #2d3748;
      color: #f9fafb;
    }
    .dark canvas {
      background-color: #2d3748;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans transition-all duration-300" onload="initDashboard();">
  <!-- Header -->
  <header class="bg-white shadow-md fixed w-full top-0 z-10">
    <div class="relative flex items-center h-16 px-4">
      <div class="text-xl font-bold text-indigo-600">ef-shops.at ShopMaster v1.17</div>
      <div class="absolute left-1/2 transform -translate-x-1/2">
        <input type="text" placeholder="Suchen..." class="border px-3 py-1 text-sm rounded w-64 text-center" />
      </div>
      <div class="ml-auto flex space-x-2 items-center">
        <button onclick="toggleDarkMode()" class="text-sm bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 transition" title="Dark Mode">
          üåì
        </button>
        <button onclick="exportJSON()" class="text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition" title="Exportieren">
          Export JSON
        </button>
        <label for="importFile" class="text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 cursor-pointer" title="Importieren">
          Import JSON
        </label>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(event)" />
      </div>
    </div>
  </header>

  <!-- Layout -->
  <div class="flex pt-16 h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r px-4 py-6 space-y-4">
      <nav class="space-y-2">
        <button onclick="showTab('dashboard')" class="block w-full text-left px-3 py-2 hover:bg-gray-100 font-medium">Dashboard</button>
        <button onclick="showTab('produkte')" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Produkte</button>
        <button onclick="showTab('bestellungen')" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Bestellungen</button>
        <button onclick="showTab('kunden')" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Kunden</button>
        <button onclick="showTab('berichte')" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Berichte</button>
        <button onclick="showTab('einstellungen')" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Einstellungen</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto">
      <!-- Dashboard Tab -->
      <section id="dashboard" class="tab active-tab">
        <h2 class="text-2xl font-semibold mb-4">Dashboard</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-medium">Umsatz (heute)</h3>
            <p class="text-2xl font-bold mt-2" id="umsatzHeute">‚Ç¨ 5.840</p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-medium">Bestellungen</h3>
            <p class="text-2xl font-bold mt-2" id="dashboardBestellungenCount">0</p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-medium">Produkte auf Lager</h3>
            <p class="text-2xl font-bold mt-2" id="dashboardProdukteCount">0</p>
          </div>
        </div>
        <div class="bg-white p-4 rounded shadow">
          <h3 class="text-lg font-medium mb-2">Umsatzdiagramm</h3>
          <canvas id="salesChart" height="100"></canvas>
        </div>
      </section>

      <!-- Produkte Tab -->
      <section id="produkte" class="tab hidden-tab">
        <h2 class="text-2xl font-semibold mb-4">Produkte</h2>
        <form onsubmit="addProdukt(event)" class="bg-white p-4 rounded shadow mb-4">
          <h3 class="text-lg font-medium mb-2">Neues Produkt hinzuf√ºgen</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" placeholder="Produktname" id="produktName" required class="border p-2 rounded" />
            <input type="number" step="0.01" placeholder="Preis (‚Ç¨)" id="produktPreis" required class="border p-2 rounded" />
            <input type="number" placeholder="Lagerbestand" id="produktLager" required class="border p-2 rounded" />
          </div>
          <button type="submit" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Hinzuf√ºgen</button>
        </form>
        <table class="min-w-full table-auto bg-white rounded shadow overflow-hidden">
          <thead>
            <tr class="bg-gray-100 text-left">
              <th class="p-3">Produkt</th>
              <th class="p-3">Preis</th>
              <th class="p-3">Lager</th>
              <th class="p-3">Aktionen</th>
            </tr>
          </thead>
          <tbody id="produkteListe"></tbody>
        </table>
      </section>

      <!-- Bestellungen Tab -->
      <section id="bestellungen" class="tab hidden-tab">
        <h2 class="text-2xl font-semibold mb-4">Bestellungen</h2>
        <form onsubmit="addBestellung(event)" class="bg-white p-4 rounded shadow mb-4">
          <h3 class="text-lg font-medium mb-2">Neue Bestellung hinzuf√ºgen</h3>
          <input type="text" placeholder="Bestellnummer" id="bestellNummer" required class="border p-2 rounded w-full mb-2" />
          <label class="block mb-1 font-medium">Produkte ausw√§hlen:</label>
          <select id="bestellProdukte" multiple size="5" class="border p-2 rounded w-full mb-2"></select>
          <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Hinzuf√ºgen</button>
        </form>
        <table class="min-w-full table-auto bg-white rounded shadow overflow-hidden">
          <thead>
            <tr class="bg-gray-100 text-left">
              <th class="p-3">Bestellnummer</th>
              <th class="p-3">Produkte</th>
              <th class="p-3">Status</th>
              <th class="p-3">Aktionen</th>
            </tr>
          </thead>
          <tbody id="bestellungenListe"></tbody>
        </table>
      </section>

      <!-- Kunden Tab -->
      <section id="kunden" class="tab hidden-tab">
        <h2 class="text-2xl font-semibold mb-4">Kunden</h2>
        <form onsubmit="addKunde(event)" class="bg-white p-4 rounded shadow mb-4">
          <h3 class="text-lg font-medium mb-2">Neuen Kunden hinzuf√ºgen</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" placeholder="Name" id="kundenName" required class="border p-2 rounded" />
            <input type="email" placeholder="E-Mail" id="kundenEmail" required class="border p-2 rounded" />
          </div>
          <button type="submit" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Hinzuf√ºgen</button>
        </form>
        <table class="min-w-full table-auto bg-white rounded shadow overflow-hidden">
          <thead>
            <tr class="bg-gray-100 text-left">
              <th class="p-3">Name</th>
              <th class="p-3">E-Mail</th>
              <th class="p-3">Aktionen</th>
            </tr>
          </thead>
          <tbody id="kundenListe"></tbody>
        </table>
      </section>

      <!-- Berichte Tab -->
      <section id="berichte" class="tab hidden-tab">
        <h2 class="text-2xl font-semibold mb-4">Berichte</h2>
        <p class="bg-white p-4 rounded shadow">üìä Berichte werden bald verf√ºgbar sein.</p>
      </section>

      <!-- Einstellungen Tab -->
      <section id="einstellungen" class="tab hidden-tab">
        <h2 class="text-2xl font-semibold mb-4">Einstellungen</h2>
        <p class="bg-white p-4 rounded shadow">‚öôÔ∏è Konto- und Systemeinstellungen.</p>
      </section>
    </main>
  </div>

  <!-- Modal Template -->
  <div id="modal" class="modal-bg hidden">
    <div class="modal">
      <h3 id="modalTitle" class="text-xl font-semibold mb-4"></h3>
      <form id="modalForm" onsubmit="submitModalForm(event)">
        <div id="modalContent"></div>
        <div class="mt-4 flex justify-end space-x-2">
          <button type="button" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400" onclick="closeModal()">Abbrechen</button>
          <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Speichern</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Globale Datenarrays
    const produkte = [
      { name: "Wireless Kopfh√∂rer", preis: 89.99, lager: 132 },
      { name: "Bluetooth Lautsprecher", preis: 45.50, lager: 80 },
      { name: "Smartwatch", preis: 120.00, lager: 50 }
    ];
    const kunden = [
      { name: "Anna Meier", email: "anna.meier@example.com" },
      { name: "Lukas Schmidt", email: "lukas.schmidt@example.com" }
    ];
    const bestellungen = [
      { nummer: "B001", produkte: [produkte[0], produkte[2]], status: "Offen" },
      { nummer: "B002", produkte: [produkte[1]], status: "Abgeschlossen" }
    ];

    // Tab wechseln
    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.add('hidden-tab');
        tab.classList.remove('active-tab');
      });
      document.getElementById(tabId).classList.remove('hidden-tab');
      document.getElementById(tabId).classList.add('active-tab');

      if (tabId === 'bestellungen') {
        populateBestellProdukteSelect();
      }
    }

    // Dark Mode
    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
    }

    // Produkte rendern
    function renderProdukte() {
      const tbody = document.getElementById('produkteListe');
      tbody.innerHTML = '';
      produkte.forEach((p, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3 border">${p.name}</td>
          <td class="p-3 border">‚Ç¨ ${p.preis.toFixed(2)}</td>
          <td class="p-3 border">${p.lager}</td>
          <td class="p-3 border space-x-1">
            <button onclick="openProduktModal(${i})" class="text-blue-600 hover:underline">Bearbeiten</button>
            <button onclick="deleteProdukt(${i})" class="text-red-600 hover:underline">L√∂schen</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      updateDashboardCounts();
    }

    // Kunden rendern
    function renderKunden() {
      const tbody = document.getElementById('kundenListe');
      tbody.innerHTML = '';
      kunden.forEach((k, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3 border">${k.name}</td>
          <td class="p-3 border">${k.email}</td>
          <td class="p-3 border space-x-1">
            <button onclick="openKundeModal(${i})" class="text-blue-600 hover:underline">Bearbeiten</button>
            <button onclick="deleteKunde(${i})" class="text-red-600 hover:underline">L√∂schen</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Bestellungen rendern
    function renderBestellungen() {
      const tbody = document.getElementById('bestellungenListe');
      tbody.innerHTML = '';
      bestellungen.forEach((b, i) => {
        const produktNamen = b.produkte.map(p => p.name).join(', ');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3 border">${b.nummer}</td>
          <td class="p-3 border">${produktNamen}</td>
          <td class="p-3 border">${b.status}</td>
          <td class="p-3 border space-x-1">
            <button onclick="openBestellungModal(${i})" class="text-blue-600 hover:underline">Bearbeiten</button>
            <button onclick="deleteBestellung(${i})" class="text-red-600 hover:underline">L√∂schen</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      updateDashboardCounts();
    }

    // Add Produkt
    function addProdukt(event) {
      event.preventDefault();
      const name = document.getElementById('produktName').value.trim();
      const preis = parseFloat(document.getElementById('produktPreis').value);
      const lager = parseInt(document.getElementById('produktLager').value);
      if (!name || isNaN(preis) || isNaN(lager)) {
        alert("Bitte alle Felder korrekt ausf√ºllen.");
        return;
      }
      produkte.push({ name, preis, lager });
      event.target.reset();
      renderProdukte();
    }

    // Add Kunde
    function addKunde(event) {
      event.preventDefault();
      const name = document.getElementById('kundenName').value.trim();
      const email = document.getElementById('kundenEmail').value.trim();
      if (!name || !email || !email.includes('@')) {
        alert("Bitte g√ºltige Kundendaten eingeben.");
        return;
      }
      kunden.push({ name, email });
      event.target.reset();
      renderKunden();
    }

    // Add Bestellung
    function addBestellung(event) {
      event.preventDefault();
      const nummer = document.getElementById('bestellNummer').value.trim();
      const select = document.getElementById('bestellProdukte');
      const selectedIndices = Array.from(select.selectedOptions).map(opt => parseInt(opt.value));
      if (!nummer) {
        alert("Bitte eine Bestellnummer angeben.");
        return;
      }
      if (selectedIndices.length === 0) {
        alert("Bitte mindestens ein Produkt ausw√§hlen.");
        return;
      }
      const bestellProdukte = selectedIndices.map(i => produkte[i]);
      bestellungen.push({ nummer, produkte: bestellProdukte, status: "Offen" });
      event.target.reset();
      renderBestellungen();
    }

    // Delete Produkt
    function deleteProdukt(index) {
      if (confirm(`Produkt "${produkte[index].name}" wirklich l√∂schen?`)) {
        produkte.splice(index, 1);
        renderProdukte();
        populateBestellProdukteSelect();
      }
    }

    // Delete Kunde
    function deleteKunde(index) {
      if (confirm(`Kunde "${kunden[index].name}" wirklich l√∂schen?`)) {
        kunden.splice(index, 1);
        renderKunden();
      }
    }

    // Delete Bestellung
    function deleteBestellung(index) {
      if (confirm(`Bestellung "${bestellungen[index].nummer}" wirklich l√∂schen?`)) {
        bestellungen.splice(index, 1);
        renderBestellungen();
      }
    }

    // Modal Handling for Produkt
    let modalType = null;
    let modalEditIndex = null;
    function openProduktModal(index) {
      modalType = "produkt";
      modalEditIndex = index;
      const produkt = produkte[index];
      document.getElementById('modalTitle').textContent = "Produkt bearbeiten";
      document.getElementById('modalContent').innerHTML = `
        <label class="block mb-1 font-medium">Name:</label>
        <input type="text" id="modalInputName" class="border p-2 rounded w-full mb-2" value="${produkt.name}" required />
        <label class="block mb-1 font-medium">Preis (‚Ç¨):</label>
        <input type="number" step="0.01" id="modalInputPreis" class="border p-2 rounded w-full mb-2" value="${produkt.preis}" required />
        <label class="block mb-1 font-medium">Lagerbestand:</label>
        <input type="number" id="modalInputLager" class="border p-2 rounded w-full" value="${produkt.lager}" required />
      `;
      openModal();
    }

    // Modal Handling for Kunde
    function openKundeModal(index) {
      modalType = "kunde";
      modalEditIndex = index;
      const kunde = kunden[index];
      document.getElementById('modalTitle').textContent = "Kunde bearbeiten";
      document.getElementById('modalContent').innerHTML = `
        <label class="block mb-1 font-medium">Name:</label>
        <input type="text" id="modalInputName" class="border p-2 rounded w-full mb-2" value="${kunde.name}" required />
        <label class="block mb-1 font-medium">E-Mail:</label>
        <input type="email" id="modalInputEmail" class="border p-2 rounded w-full" value="${kunde.email}" required />
      `;
      openModal();
    }

    // Modal Handling for Bestellung
    function openBestellungModal(index) {
      modalType = "bestellung";
      modalEditIndex = index;
      const bestellung = bestellungen[index];
      document.getElementById('modalTitle').textContent = "Bestellung bearbeiten";
      // Produkte als Options mit Mehrfachauswahl, die aktuell zugeordneten Produkte sind selected
      let optionsHTML = '';
      produkte.forEach((p, i) => {
        const selected = bestellung.produkte.some(bp => bp.name === p.name) ? 'selected' : '';
        optionsHTML += `<option value="${i}" ${selected}>${p.name}</option>`;
      });
      document.getElementById('modalContent').innerHTML = `
        <label class="block mb-1 font-medium">Bestellnummer:</label>
        <input type="text" id="modalInputNummer" class="border p-2 rounded w-full mb-2" value="${bestellung.nummer}" required />
        <label class="block mb-1 font-medium">Produkte ausw√§hlen:</label>
        <select id="modalSelectProdukte" multiple size="5" class="border p-2 rounded w-full mb-2">${optionsHTML}</select>
        <label class="block mb-1 font-medium">Status:</label>
        <select id="modalSelectStatus" class="border p-2 rounded w-full">
          <option value="Offen" ${bestellung.status === "Offen" ? "selected" : ""}>Offen</option>
          <option value="In Bearbeitung" ${bestellung.status === "In Bearbeitung" ? "selected" : ""}>In Bearbeitung</option>
          <option value="Abgeschlossen" ${bestellung.status === "Abgeschlossen" ? "selected" : ""}>Abgeschlossen</option>
        </select>
      `;
      openModal();
    }

    // Modal √∂ffnen / schlie√üen
    function openModal() {
      document.getElementById('modal').classList.remove('hidden');
    }
    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
      modalType = null;
      modalEditIndex = null;
    }

    // Modal Formular absenden
    function submitModalForm(event) {
      event.preventDefault();
      if (modalType === "produkt") {
        const name = document.getElementById('modalInputName').value.trim();
        const preis = parseFloat(document.getElementById('modalInputPreis').value);
        const lager = parseInt(document.getElementById('modalInputLager').value);
        if (!name || isNaN(preis) || isNaN(lager)) {
          alert("Bitte alle Felder korrekt ausf√ºllen.");
          return;
        }
        produkte[modalEditIndex] = { name, preis, lager };
        renderProdukte();
        populateBestellProdukteSelect();
      } else if (modalType === "kunde") {
        const name = document.getElementById('modalInputName').value.trim();
        const email = document.getElementById('modalInputEmail').value.trim();
        if (!name || !email || !email.includes('@')) {
          alert("Bitte g√ºltige Kundendaten eingeben.");
          return;
        }
        kunden[modalEditIndex] = { name, email };
        renderKunden();
      } else if (modalType === "bestellung") {
        const nummer = document.getElementById('modalInputNummer').value.trim();
        const select = document.getElementById('modalSelectProdukte');
        const selectedIndices = Array.from(select.selectedOptions).map(opt => parseInt(opt.value));
        const status = document.getElementById('modalSelectStatus').value;
        if (!nummer) {
          alert("Bitte eine Bestellnummer angeben.");
          return;
        }
        if (selectedIndices.length === 0) {
          alert("Bitte mindestens ein Produkt ausw√§hlen.");
          return;
        }
        const bestellProdukte = selectedIndices.map(i => produkte[i]);
        bestellungen[modalEditIndex] = { nummer, produkte: bestellProdukte, status };
        renderBestellungen();
      }
      closeModal();
    }

    // Produkte f√ºr das Bestell-Select in Form f√ºllen
    function populateBestellProdukteSelect() {
      const select = document.getElementById('bestellProdukte');
      select.innerHTML = '';
      produkte.forEach((p, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = p.name;
        select.appendChild(option);
      });
    }

    // Dashboard Counts aktualisieren
    function updateDashboardCounts() {
      document.getElementById('dashboardBestellungenCount').textContent = bestellungen.length;
      document.getElementById('dashboardProdukteCount').textContent = produkte.length;
    }

    // Beispiel: Chart.js - Einfacher Umsatz-Chart (Dummy-Daten)
    let salesChart = null;
    function initDashboard() {
      populateBestellProdukteSelect();
      renderProdukte();
      renderKunden();
      renderBestellungen();
      updateDashboardCounts();

      const ctx = document.getElementById('salesChart').getContext('2d');
      salesChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'],
          datasets: [{
            label: 'Umsatz (‚Ç¨)',
            data: [120, 200, 150, 220, 300, 250, 400],
            backgroundColor: 'rgba(99,102,241,0.2)',
            borderColor: 'rgba(99,102,241,1)',
            borderWidth: 2,
            fill: true,
            tension: 0.3,
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              labels: { color: getComputedStyle(document.body).color }
            }
          }
        }
      });
    }

    // Export JSON
    function exportJSON() {
      const data = { produkte, kunden, bestellungen };
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "efshops_data.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    // Import JSON
    function importJSON(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.produkte && data.kunden && data.bestellungen) {
            // Vollst√§ndiger √úberschreiben:
            produkte.length = 0;
            kunden.length = 0;
            bestellungen.length = 0;
            data.produkte.forEach(p => produkte.push(p));
            data.kunden.forEach(k => kunden.push(k));
            data.bestellungen.forEach(b => bestellungen.push(b));

            renderProdukte();
            renderKunden();
            renderBestellungen();
            populateBestellProdukteSelect();
            alert("Daten erfolgreich importiert!");
          } else {
            alert("Ung√ºltiges JSON-Format.");
          }
        } catch (err) {
          alert("Fehler beim Parsen der JSON-Datei.");
        }
      };
      reader.readAsText(file);
      event.target.value = ''; // Reset input
    }
  </script>
</body>
</html>
